{% extends 'base.html' %}
{% block title %}Bill Detail{% endblock %}
{% block content %}

<!-- Biil Creating  Message -->
{% if messages %}
<div class="mt-3">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}
<!-- ..................... -->

<h2>Bill {% if bill.order %} for Order: {{ bill.order.order_number }}{% elif bill.special_order %} for Special Order: {{ bill.special_order.order_number }}{% endif %}</h2>
{% if user.is_admin or user.is_cashier %}
<a href="{% url 'mark_bill_as_paid' bill.id %}" class="btn btn-success">Mark Paid</a>
<a href="{% url 'mark_bill_as_refunded' bill.id %}" class="btn btn-warning">Mark Refunded</a>
{% endif %}

<table class="table table-bordered">
    <thead>
        <tr>
            <th colspan="5" class="text-center"><h2>Restaurant Management System</h2></th>
        </tr>
        <tr>
            <th colspan="5" class="text-center"><h5><i>Restaurant Bill</i><h5></th>
        </tr>
        <tr>
            <th>Bill Number: {{ bill.bill_number }}</th>
            <th>Order Number: 
                {% if bill.order %} 
                    {{ bill.order.order_number }}
                {% elif bill.special_order %} 
                    {{ bill.special_order.order_number }}
                {% endif %}
            </th>    
            <th colspan="2">Customer Name: {{ bill.customer_name }}</th>
            <th>Date: {{ bill.created_at }}</th>
        </tr>
        <tr>
            <th>S.N.</th>
            <th>Particulars</th>
            <th>Quantity</th>
            <th>Rate</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        {% for item in bill.bill_items.all %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>
                {% if item.item_type == 'order' %}
                    {{ item.order_item.menu_item.name }}
                {% elif item.item_type == 'special' %}
                    {{ item.special_order_item.order_item }}
                {% endif %}
            </td>
            <td>{{ item.quantity }}</td>
            <td>Rs.{{ item.price }}</td>
            <td>Rs.{{ item.subtotal }}</td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <td colspan="4"><b>Total Amount:</b> Rs.{{ bill.total_amount }}</td>
        </tr>
        <tr>
            <td colspan="4"><b>Total Amount (In words):</b> {{ total_amount_in_words }} rupees only.</td>
        </tr>
        <tr>
            <td colspan="4"><b>Bill Generated By:</b> {{ bill.created_by }}</td>
            <td colspan="4"><b>Payment Status:</b> {{ bill.get_payment_status_display }}</td>
        </tr>
    </tfoot>
</table>

<!-- Print Button -->
<button onclick="printBill()" class="btn btn-primary">Print Bill</button>

<a href="{% url 'bill' %}" class="btn btn-secondary">Back to Bill List</a>

<!-- JavaScript for Printing -->
<script>
function printBill() {
    window.print();
}
</script>

{% endblock %}
